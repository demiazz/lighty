{"version":3,"file":null,"sources":["../src/walk.js","../src/engine.js","../src/index.js"],"sourcesContent":["function getMatchesFn() {\n  const e = document.documentElement;\n\n  return (\n    e.matches ||\n    e.matchesSelector ||\n    e.msMatchesSelector ||\n    e.mozMatchesSelector ||\n    e.webkitMatchesSelector ||\n    e.oMatchesSelector\n  );\n}\n\nconst matchesFn = getMatchesFn();\n\nfunction matches(element, selector) {\n  return matchesFn.call(element, selector);\n}\n\nfunction filterElements(elements) {\n  return elements.filter(e => e instanceof Element);\n}\n\nfunction toArray(nodeList) {\n  return [].slice.call(nodeList);\n}\n\nfunction walk(trees, selector, callback) {\n  let roots;\n\n  if (trees instanceof Element) {\n    roots = [trees];\n  } else if (trees instanceof NodeList) {\n    roots = filterElements(toArray(trees));\n  } else if (Array.isArray(trees)) {\n    roots = filterElements(trees);\n  } else if (typeof trees === 'string') {\n    roots = toArray(document.querySelectorAll(trees));\n  } else {\n    throw new TypeError('Unsupported type of tree root');\n  }\n\n  roots.forEach((root) => {\n    if (matches(root, selector)) {\n      callback(root);\n    }\n\n    [].slice.call(root.querySelectorAll(selector)).forEach(callback);\n  });\n}\n\n\nexport default walk;\n","import walk from './walk';\n\n\nclass Engine {\n  constructor(builder, onStart) {\n    if (!(builder instanceof Function)) {\n      throw new TypeError('Builder must be a function');\n    }\n\n    this.cacheKey = `__lighty__${Engine.getUniqueId()}`;\n    this.builder = builder;\n    this.onStart = onStart;\n\n    this.isRunning = false;\n    this.components = [];\n\n    if (document.readyState === 'loading') {\n      document.addEventListener('DOMContentLoaded', () => this.start());\n    } else {\n      // See https://connect.microsoft.com/IE/feedback/details/792880/document-readystat\n      setTimeout(() => this.start(), 1);\n    }\n  }\n\n  component(selector, ...args) {\n    const id = this.components.length;\n\n    this.components.push([id, selector, args]);\n\n    if (this.isRunning) {\n      this.build(document.body, id, selector, args);\n    }\n  }\n\n  vitalize(trees = document.body) {\n    if (!this.isRunning) {\n      throw Error('Document is not ready yet.');\n    }\n\n    this.components.forEach((component) => {\n      this.build(trees, ...component);\n    });\n  }\n\n  start() {\n    this.isRunning = true;\n\n    this.vitalize();\n\n    if (this.onStart) {\n      this.onStart();\n    }\n  }\n\n  build(trees, id, selector, args) {\n    walk(trees, selector, (element) => {\n      if (this.isCached(element, id)) {\n        return;\n      }\n\n      this.builder(element, ...args);\n      this.cache(element, id);\n    });\n  }\n\n  isCached(element, id) {\n    const cache = element[this.cacheKey];\n\n    return cache && cache.indexOf(id) !== -1;\n  }\n\n  cache(element, id) {\n    const cache = element[this.cacheKey];\n\n    element[this.cacheKey] = cache ? cache.concat(id) : [id];\n  }\n}\n\n\nEngine.getUniqueId = function getUniqueId() {\n  if (this.incrementalId == null) {\n    this.incrementalId = 0;\n  }\n\n  const result = this.incrementalId;\n\n  this.incrementalId += 1;\n\n  return result;\n};\n\n\nexport default Engine;\n","import Engine from './engine';\n\n\nfunction create(builder, onStart) {\n  return new Engine(builder, onStart);\n}\n\n\nexport default create;\n"],"names":["const","let","this"],"mappings":"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"}