{"version":3,"file":null,"sources":["../src/query-selector.js","../src/index.js","../src/builder.js","../src/application.js","../src/plugin.js"],"sourcesContent":["function getMatchesFn() {\n  const e = document.documentElement;\n\n  return (\n    e.matches ||\n    e.matchesSelector ||\n    e.msMatchesSelector ||\n    e.mozMatchesSelector ||\n    e.webkitMatchesSelector ||\n    e.oMatchesSelector\n  );\n}\n\nconst matchesFn = getMatchesFn();\n\nfunction matches(element, selector) {\n  return matchesFn.call(element, selector);\n}\n\nexport default function querySelector(tree, selector) {\n  if (tree.jquery) {\n    return tree.filter(selector).add(tree.find(selector)).toArray();\n  }\n\n  let roots;\n\n  if (tree instanceof HTMLElement) {\n    roots = [tree];\n  } else if (tree instanceof NodeList) {\n    roots = [].slice.call(tree);\n  } else if (Array.isArray(tree)) {\n    roots = tree;\n  } else if (typeof tree === 'string') {\n    roots = [].slice.call(document.querySelectorAll(tree));\n  }\n\n  return roots.reduce((nodes, root) => {\n    if (matches(root, selector)) {\n      nodes.push(root);\n    }\n\n    return nodes.concat(\n      [].slice.call(root.querySelectorAll(selector))\n    );\n  }, []);\n}\n","import Application from './application';\nimport Plugin from './plugin';\nimport querySelector from './query-selector';\n\n\nexport { querySelector };\n\nexport function create(options) {\n  return new Application(options);\n}\n\nexport function plugin(name, initializer) {\n  return function factory(...args) {\n    return new Plugin(name, initializer(...args));\n  };\n}\n","export default class Builder {\n  constructor(id, selector, proto, plugins, querySelector) {\n    this.id = id;\n    this.selector = selector;\n    this.proto = proto;\n    this.plugins = plugins;\n    this.querySelector = querySelector;\n  }\n\n  getInitializer(tree = document.body) {\n    const nodes = this.querySelector(tree, this.selector);\n\n    const components = nodes.reduce((cs, node) => {\n      if (this.checkAndUpdateCache(node)) {\n        cs.push(this.createComponent(node));\n      }\n\n      return cs;\n    }, []);\n\n    return function initializer() {\n      components.forEach((component) => {\n        if (!component.init) {\n          return;\n        }\n\n        component.init();\n      });\n    };\n  }\n\n  createComponent(node) {\n    const component = Object.keys(this.proto).reduce((instance, property) => {\n      instance[property] = this.proto[property];\n\n      return instance;\n    }, { });\n\n    this.transformComponent(component, node);\n\n    return component;\n  }\n\n  checkAndUpdateCache(node) {\n    if (node.ids && node.ids.indexOf(this.id) !== -1) {\n      return false;\n    }\n\n    node.ids = node.ids ? node.ids.concat(this.id) : [this.id];\n\n    return true;\n  }\n\n  transformComponent(component, node) {\n    this.plugins.forEach((plugin) => {\n      plugin.transform(component, node);\n    });\n  }\n}\n","import Builder from './builder';\nimport querySelector from './query-selector';\n\n\nexport default class Application {\n  constructor(options = { }) {\n    this.builders = [];\n    this.isRunning = false;\n\n    // Query selector\n\n    this.querySelector = options.querySelector || querySelector;\n\n    // Plugins\n\n    this.plugins = [];\n\n    if (options.plugins) {\n      this.plugins = options.plugins.map((plugin) => {\n        if (plugin instanceof Function) {\n          return plugin();\n        }\n\n        return plugin;\n      });\n    }\n\n    // Running\n\n    if (document.readyState !== 'loading') {\n      // See https://connect.microsoft.com/IE/feedback/details/792880/document-readystat\n      setTimeout(this.start.bind(this), 1);\n    } else {\n      document.addEventListener('DOMContentLoaded', this.start.bind(this));\n    }\n  }\n\n  component(selector, proto) {\n    const id = this.builders.length;\n    const builder = new Builder(\n      id, selector, proto, this.plugins, this.querySelector\n    );\n\n    this.builders.push(builder);\n\n    if (this.isRunning) {\n      const initializer = builder.getInitializer();\n\n      initializer();\n    }\n\n    return this;\n  }\n\n  vitalize(tree) {\n    this.builders.forEach((builder) => {\n      const initialize = builder.getInitializer(tree);\n\n      initialize();\n    });\n  }\n\n  start() {\n    this.isRunning = true;\n\n    this.vitalize();\n  }\n}\n","export default class Plugin {\n  constructor(name, transformer) {\n    this.name = name;\n    this.transformer = transformer;\n  }\n\n  transform(component, node) {\n    this.transformer(component, node);\n  }\n}\n"],"names":["getMatchesFn","const","e","document","documentElement","matches","matchesSelector","msMatchesSelector","mozMatchesSelector","webkitMatchesSelector","oMatchesSelector","element","selector","matchesFn","call","querySelector","tree","jquery","filter","add","find","toArray","let","roots","HTMLElement","NodeList","slice","Array","isArray","querySelectorAll","reduce","nodes","root","push","concat","create","options","Application","plugin","name","initializer","Plugin","args","Builder","id","proto","plugins","this","getInitializer","body","components","cs","node","checkAndUpdateCache","createComponent","forEach","component","init","Object","keys","instance","property","transformComponent","ids","indexOf","transform","builders","isRunning","map","Function","readyState","setTimeout","start","bind","addEventListener","length","builder","vitalize","initialize","transformer"],"mappings":"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"}