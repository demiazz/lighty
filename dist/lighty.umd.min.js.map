{"version":3,"file":null,"sources":["../src/selector.js","../src/index.js","../src/builder.js","../src/application.js","../src/plugin.js"],"sourcesContent":["function getMatchesFn() {\n  const e = document.documentElement;\n\n  return (\n    e.matches ||\n    e.matchesSelector ||\n    e.msMatchesSelector ||\n    e.mozMatchesSelector ||\n    e.webkitMatchesSelector ||\n    e.oMatchesSelector\n  );\n}\n\nconst matchesFn = getMatchesFn();\n\nfunction matches(element, selector) {\n  return matchesFn.call(element, selector);\n}\n\nexport default function findInTree(tree, selector) {\n  if (tree.jquery) {\n    return tree.filter(selector).add(tree.find(selector)).toArray();\n  }\n\n  let roots;\n\n  if (tree instanceof HTMLElement) {\n    roots = [tree];\n  } else if (tree instanceof NodeList) {\n    roots = [].slice.call(tree);\n  } else if (Array.isArray(tree)) {\n    roots = tree;\n  } else if (typeof tree === 'string') {\n    roots = [].slice.call(document.querySelectorAll(tree));\n  }\n\n  return roots.reduce((nodes, root) => {\n    if (matches(root, selector)) {\n      nodes.push(root);\n    }\n\n    return nodes.concat(\n      [].slice.call(root.querySelectorAll(selector))\n    );\n  }, []);\n}\n","import Application from './application';\nimport Plugin from './plugin';\n\n\nconst applications = {\n  default: new Application('default'),\n};\n\n\nexport default applications.default;\n\nexport function create(name = 'default') {\n  let instance = applications[name];\n\n  if (!instance) {\n    instance = new Application(name);\n\n    applications[name] = instance;\n  }\n\n  return instance;\n}\n\nexport function plugin(name, initializer) {\n  return function factory(...args) {\n    return new Plugin(name, initializer(...args));\n  };\n}\n","import findInTree from './selector';\n\n\nexport default class Builder {\n  constructor(id, selector, proto, plugins) {\n    this.id = id;\n    this.selector = selector;\n    this.proto = proto;\n    this.plugins = plugins;\n  }\n\n  getInitializer(tree = document.body) {\n    const nodes = findInTree(tree, this.selector);\n\n    const components = nodes.reduce((cs, node) => {\n      if (this.checkAndUpdateCache(node)) {\n        cs.push(this.createComponent(node));\n      }\n\n      return cs;\n    }, []);\n\n    return function initializer() {\n      components.forEach((component) => {\n        if (!component.init) {\n          return;\n        }\n\n        component.init();\n      });\n    };\n  }\n\n  createComponent(node) {\n    const component = Object.keys(this.proto).reduce((instance, property) => {\n      instance[property] = this.proto[property];\n\n      return instance;\n    }, { });\n\n    this.transformComponent(component, node);\n\n    return component;\n  }\n\n  checkAndUpdateCache(node) {\n    if (node.ids && node.ids.indexOf(this.id) !== -1) {\n      return false;\n    }\n\n    node.ids = node.ids ? node.ids.concat(this.id) : [this.id];\n\n    return true;\n  }\n\n  transformComponent(component, node) {\n    this.plugins.forEach((plugin) => {\n      plugin.transform(component, node);\n    });\n  }\n}\n","import Builder from './builder';\n\n\nexport default class Application {\n  constructor(name) {\n    this.name = name;\n    this.plugins = [];\n    this.builders = [];\n    this.isReady = false;\n    this.isRunning = false;\n  }\n\n  use(...plugins) {\n    if (this.isReady) {\n      throw new Error(`[${this.name}]: \\`use\\` must be used before \\`run\\``);\n    }\n\n    this.plugins = this.plugins.concat(\n      this.normalize(plugins)\n    );\n\n    return this;\n  }\n\n  component(selector, proto) {\n    const id = this.builders.length;\n    const builder = new Builder(id, selector, proto, this.plugins);\n\n    this.builders.push(builder);\n\n    if (this.isRunning) {\n      const initializer = builder.getInitializer();\n\n      initializer();\n    }\n\n    return this;\n  }\n\n  vitalize(tree) {\n    this.builders.forEach((builder) => {\n      const initialize = builder.getInitializer(tree);\n\n      initialize();\n    });\n  }\n\n  run() {\n    this.isReady = true;\n\n    if (document.readyState !== 'loading') {\n      this.start();\n    } else {\n      document.addEventListener('DOMContentLoaded', () => this.start());\n    }\n\n    return this;\n  }\n\n  start() {\n    this.isRunning = true;\n\n    this.vitalize();\n  }\n\n  normalize(plugins) {\n    return plugins.reduce((ps, p) => {\n      const instances = Array.isArray(p)\n        ? p.map(plugin => this.instantiatePlugin(plugin))\n        : this.instantiatePlugin(p);\n\n      return ps.concat(instances);\n    }, []);\n  }\n\n  // eslint-disable-next-line\n  instantiatePlugin(plugin) {\n    if (plugin instanceof Function) {\n      return plugin();\n    }\n\n    return plugin;\n  }\n}\n","export default class Plugin {\n  constructor(name, transformer) {\n    this.name = name;\n    this.transformer = transformer;\n  }\n\n  transform(component, node) {\n    this.transformer(component, node);\n  }\n}\n"],"names":["getMatchesFn","const","e","document","documentElement","matches","matchesSelector","msMatchesSelector","mozMatchesSelector","webkitMatchesSelector","oMatchesSelector","element","selector","matchesFn","call","findInTree","tree","jquery","filter","add","find","toArray","let","roots","HTMLElement","NodeList","slice","Array","isArray","querySelectorAll","reduce","nodes","root","push","concat","create","name","instance","applications","Application","plugin","initializer","Plugin","args","Builder","id","proto","plugins","this","getInitializer","body","components","cs","node","checkAndUpdateCache","createComponent","forEach","component","init","Object","keys","property","transformComponent","ids","indexOf","transform","builders","isReady","isRunning","use","Error","normalize","length","builder","vitalize","initialize","run","readyState","start","addEventListener","ps","p","instances","map","instantiatePlugin","Function","transformer","default"],"mappings":"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"}