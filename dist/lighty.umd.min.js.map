{"version":3,"file":null,"sources":["../src/walk.js","../src/index.js","../src/engine.js"],"sourcesContent":["function getMatchesFn() {\n  const e = document.documentElement;\n\n  return (\n    e.matches ||\n    e.matchesSelector ||\n    e.msMatchesSelector ||\n    e.mozMatchesSelector ||\n    e.webkitMatchesSelector ||\n    e.oMatchesSelector\n  );\n}\n\nconst matchesFn = getMatchesFn();\n\nfunction matches(element, selector) {\n  return matchesFn.call(element, selector);\n}\n\nfunction filterElements(elements) {\n  return elements.filter(e => e instanceof Element);\n}\n\nfunction toArray(nodeList) {\n  return [].slice.call(nodeList);\n}\n\nfunction walk(trees, selector, callback) {\n  let roots;\n\n  if (trees instanceof Element) {\n    roots = [trees];\n  } else if (trees instanceof NodeList) {\n    roots = filterElements(toArray(trees));\n  } else if (Array.isArray(trees)) {\n    roots = filterElements(trees);\n  } else if (typeof trees === 'string') {\n    roots = toArray(document.querySelectorAll(trees));\n  } else {\n    throw new TypeError('Unsupported type of tree root');\n  }\n\n  roots.forEach((root) => {\n    if (matches(root, selector)) {\n      callback(root);\n    }\n\n    [].slice.call(root.querySelectorAll(selector)).forEach(callback);\n  });\n}\n\n\nexport default walk;\n","import Engine from './engine';\n\n\nfunction create(builder, onStart) {\n  return new Engine(builder, onStart);\n}\n\n\nexport default create;\n","import walk from './walk';\n\n\nclass Engine {\n  constructor(builder, onStart) {\n    if (!(builder instanceof Function)) {\n      throw new TypeError('Builder must be a function');\n    }\n\n    this.cacheKey = `__lighty__${Engine.getUniqueId()}`;\n    this.builder = builder;\n    this.onStart = onStart;\n\n    this.isRunning = false;\n    this.components = [];\n\n    if (document.readyState === 'loading') {\n      document.addEventListener('DOMContentLoaded', () => this.start());\n    } else {\n      // See https://connect.microsoft.com/IE/feedback/details/792880/document-readystat\n      setTimeout(() => this.start(), 1);\n    }\n  }\n\n  component(selector, ...args) {\n    const id = this.components.length;\n\n    this.components.push([id, selector, args]);\n\n    if (this.isRunning) {\n      this.build(document.body, id, selector, args);\n    }\n  }\n\n  vitalize(trees = document.body) {\n    if (!this.isRunning) {\n      throw Error('Document is not ready yet.');\n    }\n\n    this.components.forEach((component) => {\n      this.build(trees, ...component);\n    });\n  }\n\n  start() {\n    this.isRunning = true;\n\n    this.vitalize();\n\n    if (this.onStart) {\n      this.onStart();\n    }\n  }\n\n  build(trees, id, selector, args) {\n    walk(trees, selector, (element) => {\n      if (this.isCached(element, id)) {\n        return;\n      }\n\n      this.builder(element, ...args);\n      this.cache(element, id);\n    });\n  }\n\n  isCached(element, id) {\n    const cache = element[this.cacheKey];\n\n    return cache && cache.indexOf(id) !== -1;\n  }\n\n  cache(element, id) {\n    const cache = element[this.cacheKey];\n\n    element[this.cacheKey] = cache ? cache.concat(id) : [id];\n  }\n}\n\n\nEngine.getUniqueId = function getUniqueId() {\n  if (this.incrementalId == null) {\n    this.incrementalId = 0;\n  }\n\n  const result = this.incrementalId;\n\n  this.incrementalId += 1;\n\n  return result;\n};\n\n\nexport default Engine;\n"],"names":["getMatchesFn","const","e","document","documentElement","matches","matchesSelector","msMatchesSelector","mozMatchesSelector","webkitMatchesSelector","oMatchesSelector","element","selector","matchesFn","call","filterElements","elements","filter","Element","toArray","nodeList","slice","walk","trees","callback","let","roots","NodeList","Array","isArray","TypeError","querySelectorAll","forEach","root","create","builder","onStart","Engine","Function","this","cacheKey","getUniqueId","isRunning","components","readyState","addEventListener","start","setTimeout","component","id","length","push","args","build","body","vitalize","Error","ref","isCached","this$1","cache","indexOf","concat","incrementalId","result"],"mappings":";2MAAA,SAASA,KACPC,GAAMC,GAAIC,SAASC,eAEnB,OACEF,GAAEG,SACFH,EAAEI,iBACFJ,EAAEK,mBACFL,EAAEM,oBACFN,EAAEO,uBACFP,EAAEQ,iBAMN,QAASL,GAAQM,EAASC,GACxB,MAAOC,GAAUC,KAAKH,EAASC,GAGjC,QAASG,GAAeC,GACtB,MAAOA,GAASC,OAAO,SAAAf,SAAKA,aAAagB,WAG3C,QAASC,GAAQC,GACf,SAAUC,MAAMP,KAAKM,GAGvB,QAASE,GAAKC,EAAOX,EAAUY,GAC7BC,GAAIC,EAEJ,IAAIH,YAAiBL,SACnBQ,GAASH,OACJ,IAAIA,YAAiBI,UAC1BD,EAAQX,EAAeI,EAAQI,QAC1B,IAAIK,MAAMC,QAAQN,GACvBG,EAAQX,EAAeQ,OAClB,CAAA,GAAqB,gBAAVA,GAGhB,KAAM,IAAIO,WAAU,gCAFpBJ,GAAQP,EAAQhB,SAAS4B,iBAAiBR,IAK5CG,EAAMM,QAAQ,SAACC,GACT5B,EAAQ4B,EAAMrB,IAChBY,EAASS,MAGRZ,MAAMP,KAAKmB,EAAKF,iBAAiBnB,IAAWoB,QAAQR,KC5C3D,QAASU,GAAOC,EAASC,GACvB,MAAO,IAAIC,GAAOF,EAASC,GDS7BnC,GAAMY,GAAYb,IEVZqC,EAAO,WACCF,EAASC,aACrB,MAAQD,YAAmBG,WACzB,KAAQ,IAAIR,WAAU,6BAGxBS,MAAOC,SAAW,aAAaH,EAAOI,cACtCF,KAAOJ,QAAUA,EACjBI,KAAOH,QAAUA,EAEjBG,KAAOG,WAAY,EACnBH,KAAOI,cAEuB,YAAxBxC,SAASyC,WACbzC,SAAW0C,iBAAiB,mBAAoB,iBAAMN,GAAKO,UAG3DC,WAAa,iBAAMR,GAAKO,SAAS,GAIrCT,aAAEW,mBAAUpC,gEACV,IAAQqC,GAAKV,KAAKI,WAAWO,MAE7BX,MAAOI,WAAWQ,MAAMF,EAAIrC,EAAUwC,IAEhCb,KAAKG,WACTH,KAAOc,MAAMlD,SAASmD,KAAML,EAAIrC,EAAUwC,IAI9Cf,YAAEkB,kBAAShC,aACT,mBADiBpB,SAASmD,OACnBf,KAAKG,UACV,KAAQc,OAAM,6BAGhBjB,MAAOI,WAAWX,QAAQ,SAACgB,MACvBT,GAAKc,YAAMI,GAAAlC,UAAOyB,aAIxBX,YAAES,iBACAP,KAAOG,WAAY,EAEnBH,KAAOgB,WAEDhB,KAAKH,SACTG,KAAOH,WAIXC,YAAEgB,eAAM9B,EAAO0B,EAAIrC,EAAUwC,aAC3B9B,GAAOC,EAAOX,EAAU,SAACD,GACvB,IAAM4B,EAAKmB,SAAS/C,EAASsC,GAA7B,IAIEV,GAAKJ,cAAQsB,GAAA9C,UAASyC,IACxBO,EAAOC,MAAMjD,EAASsC,aAI1BZ,YAAEqB,kBAAS/C,EAASsC,GAClB,GAAQW,GAAQjD,EAAQ4B,KAAKC,SAE7B,OAASoB,IAASA,EAAMC,QAAQZ,MAAQ,GAG1CZ,YAAEuB,iBAAMjD,EAASsC,GACf,GAAQW,GAAQjD,EAAQ4B,KAAKC,SAE7B7B,GAAU4B,KAAKC,UAAYoB,EAAQA,EAAME,OAAOb,IAAOA,IAKzDZ,EAAOI,YAAc,WACO,MAAtBF,KAAKwB,gBACPxB,KAAKwB,cAAgB,EAGvB9D,IAAM+D,GAASzB,KAAKwB,aAIpB,OAFAxB,MAAKwB,eAAiB,EAEfC"}