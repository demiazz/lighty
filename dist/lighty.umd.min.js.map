{"version":3,"file":null,"sources":["../src/selector.js","../src/index.js","../src/builder.js","../src/application.js","../src/plugin.js"],"sourcesContent":["function getMatchesFn() {\n  const e = document.documentElement;\n\n  return (\n    e.matches ||\n    e.matchesSelector ||\n    e.msMatchesSelector ||\n    e.mozMatchesSelector ||\n    e.webkitMatchesSelector ||\n    e.oMatchesSelector\n  );\n}\n\nconst matchesFn = getMatchesFn();\n\nfunction matches(element, selector) {\n  return matchesFn.call(element, selector);\n}\n\nexport default function findInTree(tree, selector) {\n  if (tree.jquery) {\n    return tree.filter(selector).add(tree.find(selector)).toArray();\n  }\n\n  let roots;\n\n  if (tree instanceof HTMLElement) {\n    roots = [tree];\n  } else if (tree instanceof NodeList) {\n    roots = [].slice.call(tree);\n  } else if (Array.isArray(tree)) {\n    roots = tree;\n  } else if (typeof tree === 'string') {\n    roots = [].slice.call(document.querySelectorAll(tree));\n  }\n\n  return roots.reduce((nodes, root) => {\n    if (matches(root, selector)) {\n      nodes.push(root);\n    }\n\n    return nodes.concat(\n      [].slice.call(root.querySelectorAll(selector))\n    );\n  }, []);\n}\n","import Application from './application';\nimport Plugin from './plugin';\n\n\nconst applications = {\n  default: new Application('default'),\n};\n\n\nexport default applications.default;\n\nexport function create(name = 'default') {\n  let instance = applications[name];\n\n  if (!instance) {\n    instance = new Application(name);\n\n    applications[name] = instance;\n  }\n\n  return instance;\n}\n\nexport function plugin(name, initializer) {\n  return function factory(...args) {\n    return new Plugin(name, initializer(...args));\n  };\n}\n","import findInTree from './selector';\n\n\nexport default class Builder {\n  constructor(id, selector, proto, plugins) {\n    this.id = id;\n    this.selector = selector;\n    this.proto = proto;\n    this.plugins = plugins;\n  }\n\n  getInitializer(tree = document.body) {\n    const nodes = findInTree(tree, this.selector);\n\n    const components = nodes.reduce((cs, node) => {\n      if (this.checkAndUpdateCache(node)) {\n        cs.push(this.createComponent(node));\n      }\n\n      return cs;\n    }, []);\n\n    return this.createInitializer(components);\n  }\n\n  createComponent(node) {\n    const component = { };\n    const properties = Object.keys(this.proto);\n\n    for (let i = 0; i < properties.length; i += 1) {\n      const property = properties[i];\n\n      if ({}.hasOwnProperty.call(this.proto, property)) {\n        component[property] = this.proto[property];\n      }\n    }\n\n    this.transformComponent(component, node);\n\n    return component;\n  }\n\n  checkAndUpdateCache(node) {\n    if (node.ids && node.ids.indexOf(this.id) !== -1) {\n      return false;\n    }\n\n    // eslint-disable-next-line\n    node.ids = node.ids ? node.ids.concat(this.id) : [this.id];\n\n    return true;\n  }\n\n  transformComponent(component, node) {\n    for (let i = 0; i < this.plugins.length; i += 1) {\n      this.plugins[i].transform(component, node);\n    }\n  }\n\n  // eslint-disable-next-line\n  createInitializer(components) {\n    return function initializer() {\n      for (let i = 0; i < components.length; i += 1) {\n        const component = components[i];\n\n        if (component.init) {\n          component.init();\n        }\n      }\n    };\n  }\n}\n","import Builder from './builder';\n\n\nexport default class Application {\n  constructor(name) {\n    this.name = name;\n    this.plugins = [];\n    this.builders = [];\n    this.isReady = false;\n    this.isRunning = false;\n  }\n\n  use(...plugins) {\n    this.plugins = this.plugins.concat(\n      this.normalize(plugins)\n    );\n\n    return this;\n  }\n\n  component(selector, proto) {\n    const id = this.builders.length;\n    const builder = new Builder(id, selector, proto, this.plugins);\n\n    this.builders.push(builder);\n\n    if (this.isRunning) {\n      const initializer = builder.getInitializer();\n\n      initializer();\n    }\n\n    return this;\n  }\n\n  vitalize(tree) {\n    for (let i = 0; i < this.builders.length; i += 1) {\n      const initialize = this.builders[i].getInitializer(tree);\n\n      initialize();\n    }\n  }\n\n  run() {\n    this.isReady = true;\n\n    if (document.readyState !== 'loading') {\n      this.start();\n    } else {\n      document.addEventListener('DOMContentLoaded', () => this.start());\n    }\n\n    return this;\n  }\n\n  start() {\n    this.isRunning = true;\n\n    this.vitalize();\n  }\n\n  normalize(plugins) {\n    return plugins.reduce((ps, p) => {\n      const instances = Array.isArray(p)\n        ? p.map(plugin => this.instantiatePlugin(plugin))\n        : this.instantiatePlugin(p);\n\n      return ps.concat(instances);\n    }, []);\n  }\n\n  // eslint-disable-next-line\n  instantiatePlugin(plugin) {\n    if (plugin instanceof Function) {\n      return plugin();\n    }\n\n    return plugin;\n  }\n}\n","export default class Plugin {\n  constructor(name, transformer) {\n    this.name = name;\n    this.transformer = transformer;\n  }\n\n  transform(component, node) {\n    this.transformer(component, node);\n  }\n}\n"],"names":["getMatchesFn","const","e","document","documentElement","matches","matchesSelector","msMatchesSelector","mozMatchesSelector","webkitMatchesSelector","oMatchesSelector","element","selector","matchesFn","call","findInTree","tree","jquery","filter","add","find","toArray","let","roots","HTMLElement","NodeList","slice","Array","isArray","querySelectorAll","reduce","nodes","root","push","concat","create","name","instance","applications","Application","plugin","initializer","Plugin","args","Builder","id","proto","plugins","this","getInitializer","body","components","cs","node","checkAndUpdateCache","createComponent","createInitializer","component","properties","Object","keys","i","length","property","hasOwnProperty","transformComponent","ids","indexOf","this$1","transform","init","builders","isReady","isRunning","use","normalize","builder","vitalize","initialize","run","readyState","start","addEventListener","ps","p","instances","map","instantiatePlugin","Function","transformer","default"],"mappings":"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"}